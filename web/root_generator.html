<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>eberban root generator</title>
	<meta name="description" content="Generator of valid eberban roots that are not yet present in the dictionary.">
	<link rel="icon" type="image/png" sizes="200x200" href="./images/icon.png">
	<link rel="stylesheet" href="./res/reset.css">
	<link rel="stylesheet" href="./res/common.css">
	<link rel="stylesheet" href="./res/root_generator.css">
	<script src="./res/wp_root_generator.js"></script>
</head>
<body>
	<div class="wrapper">
		<header>
			<h1 class="text-center">
				<a href="/">eberban</a> root&nbsp;generator
			</h1>
		</header>
		<main>
			<section>
				<p class="text-center">
					This page generates random valid eberban roots that are not
					yet present in the official dictionary. Hit üîÅ to generate
					new words.
				</p>
				<p class="text-center">
					Words are classified by length, shorter forms being
					preferred for more common concepts.
				</p>
				<div>
					<button id="intransitive" onclick="bundle.refresh('intransitive')">Intransitive</button>
					<button id="transitive" onclick="bundle.refresh('transitive')">Transitive</button>
				</div>
			</section>
			<section class="carousel">
				<div class="carousel-viewport-container">
					<ol class="carousel-viewport">
						<li class="carousel-column">
							<h3 class="text-center">Short</h3>
							<ul id="short-roots" class="text-center"></ul>
						</li>
						<li class="carousel-column">
							<h3 class="text-center">Medium</h3>
							<ul id="medium-roots" class="text-center"></ul>
						</li>
						<li class="carousel-column">
							<h3 class="text-center">Long</h3>
							<ul id="long-roots" class="text-center"></ul>
						</li>
						<li class="carousel-column">
							<h3 class="text-center">Longer</h3>
							<ul id="longer-roots" class="text-center"></ul>
						</li>
					</ol>
					<button id="refresh" onclick="bundle.refresh()">üîÅ</button>
					<button id="prev" onclick="goAdjacent('left')">‚óÄÔ∏è</button>
					<button id="next" onclick="goAdjacent('right')">‚ñ∂Ô∏è</button>
				</div>

				<ol class="carousel-nav">
					<li>
						<button onclick="goToLeftMostColumns()"">
							11111
						</button>
					</li>
					<li>
						<button onclick="goToMiddleTwoColumns()">
							2222
						</button>
					</li>
					<li>
						<button onclick="goToRightMostColumns()">
							333333
						</button>
					</li>
				</ol>
			</section>
			<script>
				// TODO move this all into another JS file rip

				let offScreenElement = null;
				function assignOffscreenElement(entries) {
					for (const entry of entries) {
						if (!entry.isIntersecting) {
							offScreenElement = entry.target;
						}
					}
				}
				const observer = new IntersectionObserver(
					assignOffscreenElement,
					{ 
						root: document.getElementById("carousel-viewport"),
						threshold: 1,
					},
				);
				observer.observe(document.getElementById("medium-roots"));
				observer.observe(document.getElementById("long-roots"));
				const carouselViewPort = document.getElementById("carousel-viewport");

				// spaghetti code alert!! TODO clean this up. will be easier
				// to reason about this when i'm in another file
				// might need a diagram

				function goToMiddleTwoColumns() {
					location.href = `#${offScreenElement?.id}`;
				}

				function goToLeftMostColumns() {
					location.href = "#short-roots";
					tmpIndex = 0;
				}

				function goToRightMostColumns() {
					location.href = "#longer-roots";
					tmpIndex = 2;
				}

				// todo fix all the names
				const tmpName = [
					goToLeftMostColumns,
					goToMiddleTwoColumns,
					goToRightMostColumns
				]
				let tmpIndex = 0;
				function goAdjacent(direction) {
					// credit: https://web.archive.org/web/20090717035140if_/javascript.about.com/od/problemsolving/a/modulobug.htm
					const mod = (n, modulus) => ((n % modulus) + modulus) % modulus;
					if (direction === "left") {
						tmpIndex = mod(tmpIndex - 1, tmpName.length);

					} else if (direction === "right") {
						tmpIndex = mod(tmpIndex + 1, tmpName.length);
					}
					tmpName[tmpIndex]();
				}

				let onFinishedResizingId;
				window.onresize = function() {
					clearTimeout(onFinishedResizingId);
					onFinishedResizingId = setTimeout(tmpName[tmpIndex], 100);
				}

				// todo cache the columns you're on

				// Do not generate roots with every refresh.
				// Only with the first visit and button presses.
				// TODO
				// this will involve storing the roots in localstorage
				//if (localStorage.getItem("transitivity") === null) {
					bundle.refresh();
				//} else {
				//	; // loadRoots; but this logic can be relegated to root_generator.js
				//}
			</script>
		</main>
	</div>
</body>
</html>
