<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf8">
	<title>eberban dictionary</title>
	<link rel="icon" type="image/png" sizes="200x200" href="/icon.png">
</head>

<body>
	<div class="wrapper">
		<header>
			<h1 class="text-center">
				<a href="..">eberban</a> dictionary
			</h1>
			<div>
				<small>particles</small> <!-- TODO asterisk -->
				<small>roots</small>
				<small>compounds</small>
			</div>
		</header>
		<main>
			<section>
				<input> <!-- TODO search bar -->
				<div> <!-- TODO prefix buttons: # @ ! ? -->
					<button></button>
					<button></button>
					<button></button>
					<button></button>
				</div>
				<details>
					<!-- TODO How searching works -->
				</details>
			</section>
			<hr>
			<section>
				<small>results found</small> <!-- TODO -->
				<!-- TODO templates go here -->
			</section>
		</main>
	</div>
</body>

<script type="module">
    import { count_word_types, html_dictionary } from "./dictionary";

	const word_count = count_word_types();
	document.getElementById("particles-count").innerHTML = word_count.particles;
	document.getElementById("roots-count").innerHTML = word_count.roots;
	document.getElementById("compounds-count").innerHTML = word_count.compounds;

	const searchBar = document.getElementById("search");

	function search(query) {
		const filters = query.split(",");
		document.getElementById("dictionary").innerHTML = html_dictionary(filters);
		window.scrollTo(0, 0);
	}

	const searchFromUrl = (e) => {
		// decodeURI does stuff like "%20" -> " ".
		// substring(1) gets rid of initial "#".
		const urlQuery = decodeURI(location.hash.substring(1));
		search(urlQuery);
		// This does not trigger the searchBar's onkeyup event.
		searchBar.value = urlQuery;
	}
	const searchFromSearchBar = (e) => {
		const searchBarQuery = searchBar.value;
		search(searchBarQuery);
		// This changes the hash without triggering onhashchange.
		history.replaceState({}, "", "#" + searchBarQuery);
	}

	searchFromUrl();

	onhashchange = searchFromUrl;
	searchBar.addEventListener("keyup", searchFromSearchBar);
</script>

</html>
